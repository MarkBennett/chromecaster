<html>
    <body>
        <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
        <script>
(function() {
  var APPLICATION_ID = "7501E4AA";
  var MSG_NAMESPACE = "urn:x-cast:ca.burmis.namespace";
  
  window['__onGCastApiAvailable'] = function(loaded, errorInfo) {
    if (loaded) {
      initializeCastApi();
    } else {
      log(errorInfo);
    }
  }
  
  function initializeCastApi() {
    log("Initializing Cast...");
    
    var sessionRequest = new chrome.cast.SessionRequest(APPLICATION_ID);
    var apiConfig = new chrome.cast.ApiConfig(sessionRequest,
      sessionListener,
      receiverListener);
    chrome.cast.initialize(apiConfig, onInitSuccess, onError);
  }

  function receiverListener(e) {
    log("Receiver event");
    console.dir(e);
    
    if( e === chrome.cast.ReceiverAvailability.AVAILABLE) {
      log("Receiver Available");
    }
  }
  
  function sessionListener(e) {
    log("Session event");
    console.dir(e);
    
    var session = e;
    if (session.media.length != 0) {
      onMediaDiscovered('onRequestSessionSuccess', session.media[0]);
    }
  }
  
  function onInitSuccess() {
    log("Cast initialized successfully.");
    
    launchSession();
  }
  
  function onError(e) {
    log("Cast initialization error!");
    console.dir(e);
  }
  
  function launchSession() {
    log("Launching Cast session...");
    
    chrome.cast.requestSession(onRequestSessionSuccess, onLaunchError);
  }
  
  function onRequestSessionSuccess(e) {
    log("Session launched!");
    console.dir(e);
    
    var session = e;
    
    var btn_elem = document.getElementById("send_msg_btn");
    btn_elem.disabled = false;
    
    sendMessage(session, "Hello from the sender!");
  }
  
  function onLaunchError(e) {
    log("Session launch error!");
    console.dir(e);
  }
  
  function sendMessage(session, body) {
    session.sendMessage(MSG_NAMESPACE, "Hello?", onSendMsgSuccess, onSendMsgError);
  }
  window.sendMessage = sendMessage;
  
  function onSendMsgSuccess(e) {
    log("Message sent successfully.");
    console.dir(e);
  }
  
  function onSendMsgError(e) {
    log("Messaging error!");
    console.dir(e);
  }
  
  function log(message) {
    console.log(message);
    var elem = document.getElementById("logger");
    
    elem.innerHTML = elem.innerHTML + message + "\n";
  }
  
  window.onload = function() {
      var btn_elem = document.getElementById("send_msg_btn");
      
      btn_elem.addEventListener('click', function(e) {
          var msg = document.getElementById("msg").value;
          
          window.sendMessage(msg);
      });
  };
}());
        </script>
        <input type="text" id="msg" placeholder="your message here...">
        <button id="send_msg_btn" disabled>Send</button>
        <div>
            <pre id="logger"></pre>
        </div>
    </body>
</html>

<h1>Test</h1>
